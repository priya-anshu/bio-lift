# Vercel Deployment Setup Guide

This guide will help you deploy your BioLift application (frontend + backend) to Vercel.

## ğŸ“‹ Prerequisites

1. **GitHub Repository**: Your code should be pushed to GitHub (`priya-anshu/bio-lift`)
2. **Vercel Account**: Sign up at [vercel.com](https://vercel.com) (free tier is fine)
3. **Firebase Service Account Key**: You'll need your `serviceAccountKey.json` file content

## ğŸš€ Step-by-Step Setup

### Step 1: Prepare Environment Variables

Before deploying, gather these values:

1. **Firebase Service Account JSON**
   - Open `server/serviceAccountKey.json`
   - Copy the entire JSON content
   - You'll paste this as an environment variable in Vercel

2. **Firebase Database URL**
   - Usually: `https://project_namexyzzzz.com`
   - Check your Firebase console if different

3. **Frontend URL** (optional)
   - Will be auto-generated by Vercel (e.g., `https://bio-lift.vercel.app`)

### Step 2: Import Project to Vercel

1. Go to [vercel.com](https://vercel.com) and sign in
2. Click **"Add New..."** â†’ **"Project"**
3. Click **"Import Git Repository"**
4. Select your GitHub repository: `username/repo_name`
5. Click **"Import"**

### Step 3: Configure Project Settings

In the Vercel import screen, configure:

#### **Framework Preset**
- Select: **"Create React App"** (should auto-detect)

#### **Root Directory**
- Keep as: `./` (root)

#### **Build and Output Settings**
- **Build Command**: `npm run build` (should be auto-filled)
- **Output Directory**: `build` (should be auto-filled)
- **Install Command**: `npm install` (should be auto-filled)

**âš ï¸ Important**: Make sure these toggles are **OFF** (gray) - Vercel will auto-detect them

### Step 4: Add Environment Variables

Before clicking "Deploy", click on **"> Environment Variables"** and add:

#### Required Variables:

1. **`FIREBASE_SERVICE_ACCOUNT`**
   - **Value**: Paste the entire JSON content from `serviceAccountKey.json`
   - **Example**: `{"type":"service_account","project_id":"project_namexyzzzz",...}`
   - **Environments**: Production, Preview, Development (select all)

2. **`FIREBASE_DATABASE_URL`**
   - **Value**: `https://project_namexyzzzz.com`
   - **Environments**: Production, Preview, Development (select all)

3. **`FRONTEND_URL`** (Optional - will be auto-set by Vercel)
   - **Value**: Leave empty or use `*` for now
   - Vercel will provide the URL after deployment
   - **Environments**: Production, Preview, Development

4. **`REACT_APP_API_URL`** (Optional - for frontend)
   - **Value**: Leave empty for now
   - After deployment, set to: `https://your-project.vercel.app/api`
   - **Environments**: Production, Preview, Development

### Step 5: Deploy

1. Click **"Deploy"** button
2. Wait for the build to complete (usually 2-5 minutes)
3. Once deployed, Vercel will provide you with:
   - **Production URL**: `https://bio-lift-xxxxx.vercel.app`
   - **Deployment Status**: Success/Failed

### Step 6: Update Environment Variables (After First Deployment)

After the first deployment:

1. Go to your project dashboard on Vercel
2. Navigate to **Settings** â†’ **Environment Variables**
3. Update **`FRONTEND_URL`**:
   - Set to your production URL: `https://bio-lift-xxxxx.vercel.app`
4. Update **`REACT_APP_API_URL`**:
   - Set to: `https://bio-lift-xxxxx.vercel.app/api`
5. **Redeploy** the project (Settings â†’ Deployments â†’ Redeploy)

## ğŸ”§ Project Structure for Vercel

```
bio-lift/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.js          # Vercel serverless function (Express API)
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ rankingEngine.js  # Ranking logic
â”‚   â””â”€â”€ middleware/
â”‚       â””â”€â”€ auth.js       # Auth middleware
â”œâ”€â”€ src/                  # React frontend
â”œâ”€â”€ public/               # Static assets
â”œâ”€â”€ package.json          # Root dependencies (includes server deps)
â”œâ”€â”€ vercel.json           # Vercel configuration
â””â”€â”€ build/                # Build output (generated)
```

## ğŸ“ How It Works

1. **Frontend**: React app is built and served as static files
2. **Backend**: Express API runs as Vercel serverless functions in `/api` directory
3. **Routing**: 
   - All `/api/*` requests â†’ handled by `api/index.js`
   - All other requests â†’ served from `build/` directory

## ğŸ” Testing Your Deployment

After deployment, test these endpoints:

1. **Health Check**: `https://your-project.vercel.app/health`
2. **API Root**: `https://your-project.vercel.app/api/`
3. **Leaderboard**: `https://your-project.vercel.app/api/api/leaderboard`
4. **Frontend**: `https://your-project.vercel.app/`

## ğŸ› Troubleshooting

### Issue: "Firebase Admin initialization failed"
- **Solution**: Make sure `FIREBASE_SERVICE_ACCOUNT` is set correctly as a JSON string

### Issue: "Cannot find module '../server/rankingEngine'"
- **Solution**: Ensure all server dependencies are in root `package.json`

### Issue: "CORS errors"
- **Solution**: Update `FRONTEND_URL` environment variable to your Vercel URL

### Issue: "API returns 404"
- **Solution**: Check that `vercel.json` routes are configured correctly

### Issue: "Build fails"
- **Solution**: Check build logs in Vercel dashboard for specific errors

## ğŸ”„ Updating Your Deployment

After making changes:

1. **Push to GitHub**: `git push origin main`
2. **Auto-Deploy**: Vercel will automatically detect changes and redeploy
3. **Manual Deploy**: Or go to Vercel dashboard â†’ Deployments â†’ Redeploy

## ğŸ“š Additional Resources

- [Vercel Documentation](https://vercel.com/docs)
- [Vercel Serverless Functions](https://vercel.com/docs/functions)
- [Environment Variables](https://vercel.com/docs/environment-variables)

## âœ… Post-Deployment Checklist

- [ ] Environment variables are set correctly
- [ ] Health check endpoint works (`/health`)
- [ ] API endpoints respond correctly (`/api/leaderboard`)
- [ ] Frontend loads without errors
- [ ] Firebase authentication works
- [ ] Ranking system functions properly
- [ ] CORS is configured correctly

---

**Need Help?** Check the Vercel deployment logs in your project dashboard for detailed error messages.

